<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Water Use Visualization</title>
<style>
  :root{
    --bg:#f4f8f7;
    --card:#ffffff;
    --muted:#6b7280;
    --accent:#007c6f;
    --water:#1fa3d6;
  }
  body{
    margin:0;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background:var(--bg);
    color:#0f172a;
    display:flex;
    align-items:center;
    justify-content:center;
    min-height:100vh;
    padding:40px;
  }
  .module{
    width:980px;
    max-width:100%;
    background: linear-gradient(180deg, #fff 0%, #fafcfb 100%);
    border-radius:16px;
    box-shadow:0 10px 30px rgba(12,18,20,0.06);
    padding:28px;
    display:flex;
    gap:28px;
    align-items:center;
    justify-content:space-between;
    flex-wrap:wrap;
  }
  .visual{ display:flex; gap:18px; align-items:center; }
  .bottle-card{
    background:var(--card);
    padding:14px;
    border-radius:12px;
    box-shadow:0 6px 18px rgba(4,8,10,0.06);
    text-align:center;
  }
  .falls{
    width:96px;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:10px;
  }
  .fall-title{ font-size:13px; color:var(--muted); text-align:center; }
  .drops{
    width:60px; height:220px;
    position:relative; overflow:hidden;
    display:flex; align-items:flex-start; justify-content:center;
  }
  .drop{
    position:absolute;
    width:10px; height:18px;
    border-radius:12px;
    background: linear-gradient(180deg,var(--water), #087ea8);
    opacity:0.95;
    transform: translateY(-60px) scaleY(0.9);
    animation: drop-fall linear infinite;
    box-shadow:0 2px 6px rgba(11,84,122,0.12);
  }
  .drop.d1{ left:14px; animation-duration:1.1s; animation-delay:0s; }
  .drop.d2{ left:26px; animation-duration:1.4s; animation-delay:.2s; opacity:.85;}
  .drop.d3{ left:38px; animation-duration:1.25s; animation-delay:.45s; opacity:.9;}
  .drop.d4{ left:6px;  animation-duration:1.6s; animation-delay:.9s; opacity:.8;}

  @keyframes drop-fall {
    0% { transform: translateY(-40%) scaleY(.75); opacity:0; }
    6% { opacity:1; }
    40% { transform: translateY(20%) scaleY(1.05); }
    85% { transform: translateY(300%) scaleY(.85); opacity:0.6; }
    100% { transform: translateY(420%) scaleY(.6); opacity:0; }
  }

  .info{
    flex:1;
    min-width:260px;
    display:flex;
    flex-direction:column;
    gap:12px;
    padding:6px 6px 6px 0;
  }
  .title{ font-size:18px; font-weight:600; }
  .subtitle{ font-size:13px; color:var(--muted); }
  .stats-row{
    display:flex;
    gap:18px;
    align-items:center;
    margin-top:6px;
    flex-wrap:wrap;
  }
  .stat{
    background:var(--card);
    padding:12px 14px;
    border-radius:10px;
    box-shadow:0 6px 16px rgba(6,10,12,0.04);
    min-width:180px;
    display:flex;
    flex-direction:column;
    gap:6px;
  }
  .stat .big{
    font-size:28px;
    font-weight:700;
    color:var(--accent);
    display:flex;
    align-items:baseline;
    gap:8px;
  }
  .stat .small{ color:var(--muted); font-size:13px; }

  .meter{
    height:10px;
    background: linear-gradient(90deg,#e6f6fb, #f2fbff);
    border-radius:8px;
    overflow:hidden;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.6);
  }
  .meter-fill{
    height:100%;
    width:0%;
    background: linear-gradient(90deg, var(--water), #087ea8);
    transition: width 1.4s cubic-bezier(.2,.9,.3,1);
  }
  .caption{ margin-top:8px; font-size:12px; color:var(--muted); }

  @media (max-width:820px){
    .module{ padding:18px; gap:18px; }
    .visual{ order:1; width:100%; justify-content:center; }
    .info{ order:2; width:100%; }
    .falls{ display:none; }
  }
</style>
</head>
<body>

<div class="module" role="region" aria-label="Water use visualization">
  <div class="visual">
    <!-- Waterfall -->
    <div class="falls" aria-hidden="true">
      <div class="fall-title">Visual metaphor: water leaving</div>
      <div class="drops" id="drops">
        <div class="drop d1"></div>
        <div class="drop d2"></div>
        <div class="drop d3"></div>
        <div class="drop d4"></div>
      </div>
      <div class="fall-title" style="font-size:12px;color:var(--muted)">6.15% decrease vs 2023</div>
    </div>

    <!-- Bottle -->
    <div class="bottle-card">
      <svg id="bottleSvg" viewBox="0 0 200 360" width="200" height="360" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Bottle showing water level">
        <defs>
          <!-- Bottle clip -->
          <clipPath id="bottleClip">
            <path d="M58 20
                     C58 14, 64 10, 72 10
                     L128 10
                     C136 10,142 14,142 20
                     L142 56
                     C142 64,134 68,126 68
                     L86 68
                     C78 68,70 64,70 56
                     Z
                     M68 68
                     L68 300
                     C68 318,88 330,102 330
                     C116 330,136 318,136 300
                     L136 68
                     Z"/>
          </clipPath>

          <!-- Water gradient -->
          <linearGradient id="waterGrad" x1="0" x2="0" y1="0" y2="1">
            <stop offset="0%" stop-color="#3cc9f0"/>
            <stop offset="100%" stop-color="#087ea8"/>
          </linearGradient>

          <!-- A wave shape we can move horizontally -->
          <path id="wavePath" d="M0 20 Q25 0 50 20 T100 20 T150 20 T200 20 V60 H0 Z"/>
        </defs>

        <!-- Bottle outline -->
        <path d="M58 20
                 C58 14, 64 10, 72 10
                 L128 10
                 C136 10,142 14,142 20
                 L142 56
                 C142 64,134 68,126 68
                 L86 68
                 C78 68,70 64,70 56
                 Z
                 M68 68
                 L68 300
                 C68 318,88 330,102 330
                 C116 330,136 318,136 300
                 L136 68
                 Z"
              fill="none" stroke="#d6eaea" stroke-width="4" stroke-linejoin="round" stroke-linecap="round"/>

        <!-- Clipped interior -->
        <g clip-path="url(#bottleClip)">
          <!-- This rect is the "water volume" that grows UP from the bottom -->
          <!-- We'll animate its y + height so it starts at bottom and fills upward -->
          <rect id="waterRect" x="0" y="300" width="200" height="0" fill="url(#waterGrad)" opacity="0.92"></rect>

          <!-- Waves sit at the top of the water volume -->
          <g id="waveGroup">
            <use href="#wavePath" id="wave1" x="0" y="0" fill="#1fa3d6" opacity="0.95"></use>
            <use href="#wavePath" id="wave2" x="-60" y="3" fill="#0f8fbf" opacity="0.55"></use>
          </g>

          <!-- Subtle bubbles (static) -->
          <g id="bubbles" opacity="0.8">
            <circle cx="120" cy="240" r="4" fill="#ffffff" opacity="0.08"></circle>
            <circle cx="90"  cy="270" r="6" fill="#ffffff" opacity="0.06"></circle>
            <circle cx="110" cy="290" r="3" fill="#ffffff" opacity="0.05"></circle>
          </g>
        </g>

        <!-- Neck highlight -->
        <rect x="68" y="12" width="64" height="20" rx="6" ry="6" fill="#f8fbfd" opacity="0.8"/>
      </svg>

      <div style="margin-top:10px; text-align:center">
        <div id="bottlePercent" style="font-size:20px; font-weight:700; color:var(--accent)">-6.15%</div>
        <div style="font-size:13px; color:var(--muted); margin-top:6px">decrease in water consumption vs 2023</div>
      </div>
    </div>
  </div>

  <div class="info">
    <div>
      <div class="title">2024 NYC Commercial Office Water Use</div>
      <div class="subtitle">Visualization of change and intensity for 2024</div>
    </div>

    <div class="stats-row" role="list">
      <div class="stat" role="listitem" aria-label="Percent change">
        <div class="big"><span id="percentValue">0.00</span><span style="font-size:16px;color:var(--muted)">%</span></div>
        <div class="small">Decrease in water consumption compared to 2023</div>
      </div>

      <div class="stat" role="listitem" aria-label="Water use intensity">
        <div class="big"><span id="intensityValue">0.000</span><span style="font-size:16px;color:var(--muted)"> kgal/ft²</span></div>
        <div class="small">2024 NYC Commercial Office water use intensity</div>

        <div class="caption">Relative scale</div>
        <div class="meter" role="progressbar" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0.153" style="margin-top:8px">
          <div id="meterFill" class="meter-fill"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
/* ------------------- Values ------------------- */
const percentDecrease = 6.15;      // 6.15%
const intensityVal    = 0.153;     // kgal/ft²

// VISUAL DECISION (per your request):
// Start empty at the bottom, fill to "about halfway" as the baseline,
// then drain by 6.15% of that baseline to show the decrease.
const baselineFill = 0.50;                    // ~half full
const finalFill    = baselineFill * (1 - (percentDecrease / 100)); // ~0.46925

/* ------------------- DOM ------------------- */
const waterRect = document.getElementById('waterRect');
const waveGroup = document.getElementById('waveGroup');
const wave1 = document.getElementById('wave1');
const wave2 = document.getElementById('wave2');
const meterFill = document.getElementById('meterFill');
const bottlePercentLabel = document.getElementById('bottlePercent');

/* ------------------- Helpers ------------------- */
function easeOutCubic(t){ return 1 - Math.pow(1 - t, 3); }

function animateCount(id, start, end, duration = 1400, decimals = 2) {
  const el = document.getElementById(id);
  const startTime = performance.now();
  function step(now){
    const t = Math.min((now - startTime) / duration, 1);
    const v = start + (end - start) * easeOutCubic(t);
    el.textContent = v.toFixed(decimals);
    if (t < 1) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}

/*
 Bottle interior vertical range (where water should live).
 These values match the bottle body in the SVG.
*/
const INNER_TOP = 68;
const INNER_BOTTOM = 300;
const INNER_HEIGHT = INNER_BOTTOM - INNER_TOP;

/*
 level = 0..1
 0 -> empty at bottom
 1 -> full up to INNER_TOP
*/
function setWaterLevel(level){
  level = Math.max(0, Math.min(1, level));
  const h = INNER_HEIGHT * level;
  const y = INNER_BOTTOM - h;

  waterRect.setAttribute('y', y.toFixed(2));
  waterRect.setAttribute('height', h.toFixed(2));

  // Position waves at the top surface of the water.
  // If empty, keep waves hidden below bottom.
  const waveY = (h <= 1) ? INNER_BOTTOM + 40 : (y - 18);
  waveGroup.setAttribute('transform', `translate(0, ${waveY.toFixed(2)})`);
}

/* Horizontal wave motion (independent of fill) */
let waveX = 0;
function tickWaves(){
  waveX += 0.7;
  const x1 = (waveX % 200) - 200;     // loops nicely
  const x2 = ((waveX * 0.7) % 200) - 200;

  wave1.setAttribute('x', x1.toFixed(2));
  wave2.setAttribute('x', (x2 - 60).toFixed(2));
  requestAnimationFrame(tickWaves);
}

/* Adjust waterfall speed based on decrease magnitude */
function adjustDropSpeed(){
  const drops = document.querySelectorAll('.drop');
  const factor = Math.max(0.7, 1.6 - (percentDecrease / 30) * 0.9);
  drops.forEach(d => {
    const current = parseFloat(getComputedStyle(d).animationDuration) || 1.4;
    d.style.animationDuration = (current * factor) + 's';
  });
}

/* Generic tween */
function tween(from, to, duration, onUpdate, onDone){
  const t0 = performance.now();
  function step(now){
    const t = Math.min((now - t0) / duration, 1);
    const v = from + (to - from) * easeOutCubic(t);
    onUpdate(v);
    if (t < 1) requestAnimationFrame(step);
    else if (onDone) onDone();
  }
  requestAnimationFrame(step);
}

/* ------------------- Run sequence ------------------- */
function runVisualization(){
  bottlePercentLabel.textContent = `-${percentDecrease.toFixed(2)}%`;

  // Start empty (bottom)
  setWaterLevel(0);

  // Counters
  animateCount('percentValue', 0, percentDecrease, 1400, 2);
  animateCount('intensityValue', 0, intensityVal, 1400, 3);

  // Fill meter (scaled)
  const maxForMeter = 0.6;
  const fillPct = Math.min(100, (intensityVal / maxForMeter) * 100);
  setTimeout(() => { meterFill.style.width = fillPct + '%'; }, 200);

  // Bottle animation: empty -> half -> slightly lower (decrease)
  tween(0, baselineFill, 1100, setWaterLevel, () => {
    setTimeout(() => {
      tween(baselineFill, finalFill, 900, setWaterLevel);
    }, 250);
  });

  tickWaves();
  adjustDropSpeed();
}

/* Reduced motion */
const mq = window.matchMedia('(prefers-reduced-motion: reduce)');
if (mq.matches) {
  document.querySelectorAll('.drop').forEach(d => d.style.animation = 'none');
  document.getElementById('percentValue').textContent = percentDecrease.toFixed(2);
  document.getElementById('intensityValue').textContent = intensityVal.toFixed(3);
  bottlePercentLabel.textContent = `-${percentDecrease.toFixed(2)}%`;
  setWaterLevel(finalFill);
  meterFill.style.width = Math.min(100, (intensityVal / 0.6) * 100) + '%';
} else {
  setTimeout(runVisualization, 200);
}
</script>

</body>
</html>
