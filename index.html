<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Water Use Visualization</title>
<style>
  :root{
    --bg: #f4f8f7;
    --card: #ffffff;
    --muted: #6b7280;
    --accent: #007c6f; /* ESRT-ish teal — change to brand color */
    --water: #1fa3d6;
  }

  body{
    margin:0;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background:var(--bg);
    color:#0f172a;
    display:flex;
    align-items:center;
    justify-content:center;
    min-height:100vh;
    padding:40px;
  }

  .module {
    width: 980px;
    max-width:100%;
    background: linear-gradient(180deg, rgba(255,255,255,1) 0%, rgba(250,252,251,1) 100%);
    border-radius:16px;
    box-shadow:0 10px 30px rgba(12,18,20,0.06);
    padding:28px;
    display:flex;
    gap:28px;
    align-items:center;
    justify-content:space-between;
    flex-wrap:wrap;
  }

  /* Left: Bottle + Waterfall */
  .visual {
    display:flex;
    gap:18px;
    align-items:center;
  }

  .bottle-wrap{
    width:220px;
    min-width:180px;
    position:relative;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  /* card around bottle */
  .bottle-card{
    background:var(--card);
    padding:14px;
    border-radius:12px;
    box-shadow:0 6px 18px rgba(4,8,10,0.06);
    text-align:center;
  }

  /* waterfall column */
  .falls {
    width:96px;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:10px;
  }

  .fall-title{
    font-size:13px;
    color:var(--muted);
    text-align:center;
  }

  /* little drop stream */
  .drops{
    width:60px;
    height:220px;
    position:relative;
    overflow:hidden;
    display:flex;
    align-items:flex-start;
    justify-content:center;
  }

  .drop{
    position:absolute;
    width:10px;
    height:18px;
    border-radius:12px;
    background: linear-gradient(180deg,var(--water), #087ea8);
    opacity:0.95;
    transform: translateY(-60px) scaleY(0.9);
    animation: drop-fall linear infinite;
    box-shadow:0 2px 6px rgba(11,84,122,0.12);
  }

  /* staggered animations */
  .drop.d1{ left: 14px; animation-duration:1.1s; animation-delay:0s; }
  .drop.d2{ left: 26px; animation-duration:1.4s; animation-delay:0.2s; opacity:0.85;}
  .drop.d3{ left: 38px; animation-duration:1.25s; animation-delay:0.45s; opacity:0.9;}
  .drop.d4{ left: 6px;  animation-duration:1.6s; animation-delay:0.9s; opacity:0.8;}

  @keyframes drop-fall {
    0% { transform: translateY(-40%) scaleY(.75); opacity:0; }
    6% { opacity:1; }
    40% { transform: translateY(20%) scaleY(1.05); }
    85% { transform: translateY(300%) scaleY(.85); opacity:0.6; }
    100% { transform: translateY(420%) scaleY(.6); opacity:0; }
  }

  /* right: stats and texts */
  .info {
    flex:1;
    min-width:260px;
    display:flex;
    flex-direction:column;
    gap:12px;
    padding:6px 6px 6px 0;
  }

  .title {
    font-size:18px;
    font-weight:600;
  }

  .subtitle {
    font-size:13px;
    color:var(--muted);
  }

  .stats-row{
    display:flex;
    gap:18px;
    align-items:center;
    margin-top:6px;
    flex-wrap:wrap;
  }

  .stat {
    background:var(--card);
    padding:12px 14px;
    border-radius:10px;
    box-shadow:0 6px 16px rgba(6,10,12,0.04);
    min-width:180px;
    display:flex;
    flex-direction:column;
    gap:6px;
  }

  .stat .big {
    font-size:28px;
    font-weight:700;
    color:var(--accent);
    display:flex;
    align-items:baseline;
    gap:8px;
  }

  .stat .small {
    color:var(--muted);
    font-size:13px;
  }

  /* intensity meter */
  .meter {
    height:10px;
    background: linear-gradient(90deg,#e6f6fb, #f2fbff);
    border-radius:8px;
    overflow:hidden;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.6);
  }

  .meter-fill {
    height:100%;
    width:0%;
    background: linear-gradient(90deg, var(--water), #087ea8);
    transition: width 1.4s cubic-bezier(.2,.9,.3,1);
  }

  /* caption */
  .caption {
    margin-top:8px;
    font-size:12px;
    color:var(--muted);
  }

  /* responsive */
  @media (max-width:820px){
    .module { padding:18px; gap:18px; }
    .visual { order:1; width:100%; justify-content:center; }
    .info { order:2; width:100%; }
    .falls{ display:none; } /* hide waterfall on small screens */
  }
</style>
</head>
<body>

<div class="module" role="region" aria-label="Water use visualization">
  <div class="visual">
    <!-- Waterfall -->
    <div class="falls" aria-hidden="true">
      <div class="fall-title">Visual metaphor: water leaving</div>
      <div class="drops" id="drops">
        <div class="drop d1"></div>
        <div class="drop d2"></div>
        <div class="drop d3"></div>
        <div class="drop d4"></div>
      </div>
      <div class="fall-title" style="font-size:12px;color:var(--muted)">6.15% decrease vs 2023</div>
    </div>

    <!-- Bottle -->
    <div class="bottle-card" aria-hidden="false">
      <!-- SVG bottle with masked wave fill -->
      <svg id="bottleSvg" viewBox="0 0 200 360" width="200" height="360" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Bottle showing water level">
        <defs>
          <!-- bottle shape path (simple stylized bottle) -->
          <clipPath id="bottleClip">
            <path d="M58 20
                     C58 14, 64 10, 72 10
                     L128 10
                     C136 10,142 14,142 20
                     L142 56
                     C142 64,134 68,126 68
                     L86 68
                     C78 68,70 64,70 56
                     Z
                     M68 68
                     L68 300
                     C68 318,88 330,102 330
                     C116 330,136 318,136 300
                     L136 68
                     Z" fill="#fff"/>
          </clipPath>

          <!-- wave path used repeatedly -->
          <path id="wavePath" d="M 0 40 Q 25 20 50 40 T 100 40 T 150 40 T 200 40 V 120 H 0 Z" fill="#1fa3d6"/>
          
          <!-- gradient for water -->
          <linearGradient id="waterGrad" x1="0" x2="0" y1="0" y2="1">
            <stop offset="0%" stop-color="#3cc9f0"/>
            <stop offset="100%" stop-color="#087ea8"/>
          </linearGradient>
        </defs>

        <!-- bottle outline -->
        <g transform="translate(0,0)">
          <path d="M58 20
                   C58 14, 64 10, 72 10
                   L128 10
                   C136 10,142 14,142 20
                   L142 56
                   C142 64,134 68,126 68
                   L86 68
                   C78 68,70 64,70 56
                   Z
                   M68 68
                   L68 300
                   C68 318,88 330,102 330
                   C116 330,136 318,136 300
                   L136 68
                   Z" fill="none" stroke="#d6eaea" stroke-width="4" stroke-linejoin="round" stroke-linecap="round"/>

          <!-- water group clipped to bottle -->
          <g clip-path="url(#bottleClip)" id="waterGroup" transform="translate(0,0)">
            <!-- background fill behind wave for volume -->
            <rect x="0" y="0" width="200" height="360" fill="url(#waterGrad)" opacity="0.9"/>
            <!-- two waves for parallax -->
            <g id="waves" transform="translate(0,0)">
              <use href="#wavePath" x="0" y="220" opacity="0.92"></use>
              <use href="#wavePath" x="-60" y="226" opacity="0.86" style="transform-origin:50% 50%"></use>
            </g>
            <!-- subtle bubbles -->
            <g id="bubbles" opacity="0.8">
              <circle cx="120" cy="240" r="4" fill="#ffffff" opacity="0.08"></circle>
              <circle cx="90" cy="270" r="6" fill="#ffffff" opacity="0.06"></circle>
              <circle cx="110" cy="290" r="3" fill="#ffffff" opacity="0.05"></circle>
            </g>
          </g>

          <!-- top neck highlight -->
          <rect x="68" y="12" width="64" height="20" rx="6" ry="6" fill="#f8fbfd" opacity="0.8"/>
        </g>
      </svg>

      <!-- overlay text: numeric percent and labels -->
      <div style="margin-top:10px; text-align:center">
        <div id="bottlePercent" style="font-size:20px; font-weight:700; color:var(--accent)">-6.15%</div>
        <div style="font-size:13px; color:var(--muted); margin-top:6px">decrease in water consumption vs 2023</div>
      </div>
    </div><!-- bottle-card -->
  </div><!-- visual -->

  <div class="info" aria-hidden="false">
    <div>
      <div class="title">2024 NYC Commercial Office Water Use</div>
      <div class="subtitle">Visualization of change and intensity for 2024</div>
    </div>

    <div class="stats-row" role="list">
      <div class="stat" role="listitem" aria-label="Percent change">
        <div class="big"><span id="percentValue">0.00</span><span style="font-size:16px;color:var(--muted)">%</span></div>
        <div class="small">Decrease in water consumption compared to 2023</div>
      </div>

      <div class="stat" role="listitem" aria-label="Water use intensity">
        <div style="display:flex;gap:8px;align-items:center;justify-content:space-between">
          <div style="display:flex;flex-direction:column;gap:6px;flex:1">
            <div class="big"><span id="intensityValue">0.000</span><span style="font-size:16px;color:var(--muted)"> kgal/ft²</span></div>
            <div class="small">2024 NYC Commercial Office water use intensity</div>
          </div>
        </div>

        <div class="caption">Relative scale</div>
        <div class="meter" role="progressbar" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0.153" style="margin-top:8px">
          <div id="meterFill" class="meter-fill"></div>
        </div>
      </div>
    </div>
  </div><!-- info -->
</div><!-- module -->

<script>
/* ----------- Configuration (change these values to show other numbers) ----------- */
// percent decrease from 2023 to 2024
const percentDecrease = 6.15; // 6.15%

// water use intensity value
const intensityVal = 0.153; // kgal/ft2

// Bottle visual: represent 2023 level as 100% and 2024 as (100 - percentDecrease)%.
// We'll animate the water level from 100% down to 100 - percentDecrease.
const startLevelPct = 100; // starting fill (2023)
const endLevelPct = 100 - percentDecrease; // ending fill (2024)

/* ------------------- Animation helpers ------------------- */
function animateCount(id, start, end, duration = 1400, decimals = 2) {
  const el = document.getElementById(id);
  const startTime = performance.now();
  function step(now) {
    const t = Math.min((now - startTime) / duration, 1);
    // easeOutCubic
    const eased = 1 - Math.pow(1 - t, 3);
    const val = start + (end - start) * eased;
    el.textContent = val.toFixed(decimals);
    if (t < 1) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}

/* --------------- Bottle wave animation & level --------------- */
/*
 Approach:
 - The bottle's visible "water" is the clipped group 'waterGroup'.
 - We'll animate the group's translateY to set the visible level.
 - We also move the wave <use> elements horizontally to simulate movement.
*/
const svg = document.getElementById('bottleSvg');
const waterGroup = document.getElementById('waterGroup');
const waves = document.getElementById('waves');
const bottlePercentLabel = document.getElementById('bottlePercent');

function setWaterLevel(percent) {
  // percent = 0..100 where 100 is full (top)
  // The bottle viewbox height is 360; choose mapping so wave sits inside bottle area.
  const minY = 60;   // roughly top inside bottle
  const maxY = 300;  // bottom inside bottle
  // invert percent so 100% => minY (high), 0% => maxY (low)
  const y = maxY - (percent / 100) * (maxY - minY);
  // translate the waves group vertically so the wave baseline sits at y
  // Since the waves are at around y=220 in design, we'll offset waterGroup to position properly
  const desiredTop = y - 220; // 220 is wave base in svg
  waterGroup.setAttribute('transform', `translate(0,${desiredTop})`);
}

/* simple horizontal wave motion */
let wavePhase = 0;
function animateWaves() {
  wavePhase += 0.6; // speed
  // move the waves group slightly left/right (parallax)
  const tx = Math.sin(wavePhase * 0.02) * 12;
  waves.setAttribute('transform', `translate(${tx},0)`);
  requestAnimationFrame(animateWaves);
}

/* animate drops intensity: when percentDecrease is small, slow drops; when big, faster */
function adjustDropSpeed() {
  const drops = document.querySelectorAll('.drop');
  const base = 1.6;
  // map percentDecrease [0..30] -> factor [1.6..0.9] (larger decrease -> faster drops)
  const factor = Math.max(0.7, 1.6 - (percentDecrease / 30) * 0.9);
  drops.forEach(d => {
    const dur = parseFloat(getComputedStyle(d).animationDuration) || base;
    // update animation-duration by setting inline style
    d.style.animationDuration = (dur * factor) + 's';
  });
}

/* --------------- Meter fill --------------- */
const meterFill = document.getElementById('meterFill');

/* --------------- Run the full visualization sequence --------------- */
function runVisualization() {
  // 1. Animate the numeric counters
  animateCount('percentValue', 0, percentDecrease, 1400, 2);
  animateCount('intensityValue', 0, intensityVal, 1400, 3);

  // update the bottle top label immediately
  bottlePercentLabel.textContent = `-${percentDecrease.toFixed(2)}%`;

  // 2. Animate the bottle water level from 100% down to endLevelPct
  const duration = 1400;
  const start = performance.now();
  function levelStep(now) {
    const t = Math.min((now - start) / duration, 1);
    const eased = 1 - Math.pow(1 - t, 3);
    const currentPct = startLevelPct + (endLevelPct - startLevelPct) * eased;
    setWaterLevel(currentPct);
    if (t < 1) requestAnimationFrame(levelStep);
  }
  requestAnimationFrame(levelStep);

  // 3. Animate meter fill relative to intensity (we'll map intensityVal to a 0-100% bar)
  // choose a reasonable maximum for the bar: e.g., 0.6 kgal/ft2 ~ 100% on this mini meter (adjust as needed)
  const maxForMeter = 0.6;
  const fillPct = Math.min(100, (intensityVal / maxForMeter) * 100);
  setTimeout(()=> {
    meterFill.style.width = fillPct + '%';
  }, 200);

  // 4. Wave animation loop
  animateWaves();

  // 5. Adjust drop speeds based on magnitude
  adjustDropSpeed();
}

/* wait a short moment or until user scrolls into view; for simplicity, run after small delay so layout settles */
setTimeout(runVisualization, 250);

/* accessibility: pause animations when user prefers reduced motion */
const mq = window.matchMedia('(prefers-reduced-motion: reduce)');
if (mq.matches) {
  // stop wave animation and drops
  const drops = document.querySelectorAll('.drop');
  drops.forEach(d => d.style.animation = 'none');
  // place water stat at end level without animation
  setWaterLevel(endLevelPct);
  meterFill.style.width = Math.min(100, (intensityVal / 0.6) * 100) + '%';
  document.getElementById('percentValue').textContent = percentDecrease.toFixed(2);
  document.getElementById('intensityValue').textContent = intensityVal.toFixed(3);
}
</script>

</body>
</html>
